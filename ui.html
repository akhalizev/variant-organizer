<!DOCTYPE html>
    <html>
      <head>
        <style>
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            padding: 16px;
            margin: 0;
          }
          button {
            background-color: #18a0fb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
          }
          button:hover:not(:disabled) {
            background-color: #0d8bec;
          }
          button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
          }
          p {
            font-size: 14px;
            color: #333;
            margin-bottom: 16px;
          }
          p.note {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            margin-bottom: 16px;
          }
        </style>
      </head>
      <body>
        <p>Select a Component or Instance in Figma, then click the button below to organize all variants of its Component Set into labeled frames.</p>
        <button id="organize">Organize Variants</button>
        <p id="loadingMessage" class="note" style="display: none;">Please note: This process may take some time, depending on the number of variants and your system's performance.</p>
        <!-- Dark mode feature (hidden by default; enable via ENABLE_DARK_MODE flag in script) -->
        <!--
        <div id="darkFeature" style="margin-top: 16px;">
          <div style="margin-bottom: 8px;">
            <label for="collectionName" style="display: block; margin-bottom: 4px; font-size: 12px;">Variable Collection:</label>
            <input type="text" id="collectionName" value="General" style="width: 100%; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 8px;">
            <label for="lightModeName" style="display: block; margin-bottom: 4px; font-size: 12px;">Light Mode Name:</label>
            <input type="text" id="lightModeName" value="VD" style="width: 100%; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 8px;">
            <label for="darkModeName" style="display: block; margin-bottom: 4px; font-size: 12px;">Dark Mode Name:</label>
            <input type="text" id="darkModeName" value="Dark" style="width: 100%; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
          </div>
          <button id="createDarkMode" style="margin-top: 8px;">Create Dark Mode Variants</button>
        </div>
        -->
        <script>
          const organizeButton = document.getElementById('organize');
          const darkModeButton = document.getElementById('createDarkMode');

          organizeButton.onclick = () => {
            const newHeight = 220;
            parent.postMessage({ pluginMessage: { type: 'resize', width: 320, height: newHeight } }, '*');

            organizeButton.textContent = 'Organizing...';
            organizeButton.disabled = true;
            if(darkModeButton) darkModeButton.disabled = true;
            document.getElementById('loadingMessage').style.display = 'block';
            parent.postMessage({ pluginMessage: { type: 'organize-variants' } }, '*');
          };

          // Hide dark mode UI and disable handler unless enabled
          const darkFeatureEl = document.getElementById('darkFeature');
          if (!ENABLE_DARK_MODE && darkFeatureEl) {
            darkFeatureEl.style.display = 'none';
          } else if (ENABLE_DARK_MODE) {
            if (darkModeButton) {
              darkModeButton.onclick = () => {
                darkModeButton.textContent = 'Creating...';
                darkModeButton.disabled = true;
                organizeButton.disabled = true;
                const collectionName = document.getElementById('collectionName').value;
                const lightModeName = document.getElementById('lightModeName').value;
                const darkModeName = document.getElementById('darkModeName').value;
                parent.postMessage({ pluginMessage: { type: 'create-dark-mode', collectionName, lightModeName, darkModeName } }, '*');
              };
            }
          }
        </script>
      </body>
    </html>